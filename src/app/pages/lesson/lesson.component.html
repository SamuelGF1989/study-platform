<header class="header" *ngIf="currentUser$ | async as user">
  <button class="hamburger-btn" (click)="toggleMenu()">â˜°</button>

  <div class="greeting">
    <h1>Hola, {{ user.displayName || 'Usuario' }} ðŸ‘‹ Â¿Listo para aprender algo nuevo hoy?</h1>
  </div>

  <div class="avatar" (click)="toggleLogoutCard()">
    <img
      [src]="user.photoURL ? user.photoURL : defaultAvatar"
      alt="Avatar"
      class="avatar-image"
    />
  </div>

  <mat-card *ngIf="showLogoutCard" class="logout-card" (click)="$event.stopPropagation()">
    <button mat-button (click)="logout()">Cerrar sesiÃ³n</button>
  </mat-card>
</header>

<!-- MenÃº hamburguesa lateral -->
<nav class="side-menu" [class.open]="menuOpen">
  <ul>
    <li><a (click)="router.navigate(['/home']); closeMenu()">Home</a></li>
    <li><a (click)="router.navigate(['/videos']); closeMenu()">Videos</a></li>
  </ul>
</nav>

<!-- Overlay para cerrar menÃº cuando estÃ¡ abierto -->
<div *ngIf="menuOpen" class="overlay" (click)="closeMenu()"></div>

<div *ngIf="lesson$ | async as lesson; else loading" class="lesson-container">
  <section class="lesson-info">
    <h1 class="lesson-title">{{ lesson.title }}</h1>
    <p class="lesson-description">{{ lesson.description }}</p>
  </section>

  <section class="video-wrapper" style="margin-top: 1.5rem;">
    <iframe
      [src]="safeVideoUrl"
      width="560"
      height="315"
      frameborder="0"
      allowfullscreen
      title="Video de la lecciÃ³n"
    ></iframe>
  </section>

  <section class="lesson-actions">
    <button
      mat-raised-button
      color="primary"
      [disabled]="!isFinishButtonEnabled || isLessonCompleted"
      (click)="finalizarLeccion()"
      class="finish-lesson-btn"
    >
      {{ isLessonCompleted ? 'LecciÃ³n completada' : 'Finalizar lecciÃ³n' }}
    </button>
  </section>

  <section class="quizz-section" *ngIf="lesson.quizzes && lesson.quizzes.length > 0; else noQuizzes">
    <app-quizz [quizzes]="lesson.quizzes"></app-quizz>
  </section>

  <ng-template #noQuizzes>
    <p class="no-quizzes-msg">No hay quizzes disponibles para esta lecciÃ³n.</p>
  </ng-template>
</div>

<ng-template #loading>
  <p class="loading-msg">Cargando lecciÃ³n...</p>
</ng-template>
